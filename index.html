<!DOCTYPE html>
<html>
<head>
    <title>Monitor Familiar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 20px; background: #000; color: white; font-family: Arial; text-align: center; }
        button { padding: 15px 25px; margin: 10px; border: none; border-radius: 25px; font-size: 18px; background: #4CAF50; color: white; cursor: pointer; }
        button:disabled { background: #666; }
        #status { margin: 15px 0; padding: 10px; border-radius: 8px; font-weight: bold; background: #333; }
        #frameData { font-size: 2px; color: transparent; position: absolute; left: -9999px; }
        video { width: 100%; max-width: 400px; border-radius: 10px; border: 3px solid #4CAF50; margin: 15px 0; }
    </style>
</head>
<body>
    <div>
        <h1>üì∑ Monitor Familiar</h1>
        <div id="status">‚ö´ Clique em INICIAR</div>
        
        <button id="startBtn" onclick="startCamera()">üé• INICIAR TRANSMISS√ÉO</button>
        <button id="stopBtn" onclick="stopCamera()" disabled>‚èπÔ∏è PARAR</button>
        
        <!-- Frame data escondido mas acess√≠vel -->
        <div id="frameData"></div>
        <video id="localVideo" autoplay muted playsinline></video>
    </div>

    <script>
        let localStream = null;
        let isTransmitting = false;
        let frameInterval;

        async function startCamera() {
            try {
                updateStatus('üü° Iniciando c√¢mera...');
                
                localStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 320, height: 240 }, 
                    audio: false 
                });

                document.getElementById('localVideo').srcObject = localStream;
                
                updateStatus('üü¢ TRANSMITINDO');
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                isTransmitting = true;
                
                startFrameTransmission();
                
            } catch (error) {
                updateStatus('üî¥ Erro: ' + error.message);
            }
        }

        function stopCamera() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            if (frameInterval) {
                clearInterval(frameInterval);
            }
            
            updateStatus('‚ö´ Transmiss√£o parada');
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            isTransmitting = false;
            
            // Limpar frame data
            document.getElementById('frameData').textContent = '';
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function startFrameTransmission() {
            const video = document.getElementById('localVideo');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 160;
            canvas.height = 120;
            
            frameInterval = setInterval(() => {
                if (!isTransmitting) return;
                
                try {
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const imageData = canvas.toDataURL('image/jpeg', 0.7);
                    
                    // Atualizar frame data (vis√≠vel no HTML source)
                    document.getElementById('frameData').textContent = imageData;
                    
                } catch (error) {
                    console.log('Erro capturando frame');
                }
            }, 500); // 2 FPS
        }

        // Iniciar automaticamente
        setTimeout(() => {
            if (!isTransmitting) {
                startCamera();
            }
        }, 1000);
    </script>
</body>
</html>
